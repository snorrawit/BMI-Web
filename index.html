<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Health Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

body{
font-family:tahoma;
margin:0;
background:#f3f5f9;
display:flex;
}

/* Sidebar */
.sidebar{
width:220px;
background:#667eea;
color:white;
height:100vh;
padding:20px;
display:none;
}

.sidebar button{
width:100%;
margin:10px 0;
background:white;
color:#667eea;
font-weight:bold;
}

/* Main */
.main{
flex:1;
padding:20px;
}

.card{
background:white;
padding:20px;
border-radius:15px;
box-shadow:0 4px 15px rgba(0,0,0,0.1);
margin-bottom:20px;
}

input{
width:100%;
padding:10px;
margin:5px 0;
border-radius:8px;
border:1px solid #ccc;
}

button{
padding:10px;
border:none;
border-radius:8px;
background:#667eea;
color:white;
cursor:pointer;
}

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
}

td,th{
border:1px solid #ddd;
padding:8px;
text-align:center;
}

</style>
</head>

<body>

<!-- ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô 4 ‡∏ó‡∏∏‡πà‡∏° -->
<div id="sleepAlert" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:black;color:white;align-items:center;justify-content:center;flex-direction:column;z-index:999;">
<h1>üåô ‡∏Ñ‡∏ß‡∏£‡∏ô‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß</h1>
<button onclick="enterSite()">‡∏ï‡∏Å‡∏•‡∏á ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</button>
</div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
<h2>Dashboard</h2>

<button onclick="showSection('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
<button onclick="showSection('leaderboard')">ü•á Leaderboard</button>
<button onclick="showSection('bmiTable')">üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á BMI</button>
<button onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>

</div>

<div class="main">

<!-- Login -->
<div class="card" id="loginBox">
<h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
<input id="user" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
<input id="pass" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
<button onclick="register()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
<button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<!-- HOME -->
<div id="home" style="display:none">

<div class="card">
<h3 id="welcome"></h3>

<h2 id="clock"></h2>
<h3 id="streakText"></h3>

<input id="height" placeholder="‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡∏ã‡∏°.)">
<input id="weight" placeholder="‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.)">
<input id="goal" placeholder="‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏Å‡∏Å.)">

<button onclick="saveData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>

<h4 id="goalText"></h4>
<h4 id="bmiLevel"></h4>
</div>

<div class="card">
<h3>‡∏Å‡∏£‡∏≤‡∏ü‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</h3>
<canvas id="weightChart"></canvas>
</div>

<div class="card">
<h3>‡∏Å‡∏£‡∏≤‡∏ü BMI</h3>
<canvas id="bmiChart"></canvas>
</div>

</div>

<!-- BMI TABLE -->
<div id="bmiTable" style="display:none">
<div class="card">
<h3>üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏ä‡∏ô‡∏µ BMI</h3>

<table>
<tr><th>BMI</th><th>‡∏£‡∏∞‡∏î‡∏±‡∏ö</th></tr>
<tr><td>‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 18.5</td><td>‡∏ú‡∏≠‡∏°</td></tr>
<tr><td>18.5 - 22.9</td><td>‡∏õ‡∏Å‡∏ï‡∏¥</td></tr>
<tr><td>23 - 24.9</td><td>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô</td></tr>
<tr><td>25 - 29.9</td><td>‡∏≠‡πâ‡∏ß‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö 1</td></tr>
<tr><td>30 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ</td><td>‡∏≠‡πâ‡∏ß‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö 2</td></tr>
</table>

</div>
</div>

<!-- LEADERBOARD -->
<div id="leaderboard" style="display:none">

<div class="card">
<h3>ü•á ‡∏•‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
<ul id="lbWeight"></ul>
</div>

<div class="card">
<h3>üìÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠</h3>
<ul id="lbRecord"></ul>
</div>

</div>

</div>

<script>

let currentUser="";
let weightChart;
let bmiChart;

/* ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô 4 ‡∏ó‡∏∏‡πà‡∏° */
let hour=new Date().getHours();
if(hour>=22){
document.getElementById("sleepAlert").style.display="flex";
}

function enterSite(){
document.getElementById("sleepAlert").style.display="none";
}

/* Clock */
setInterval(()=>{
document.getElementById("clock").innerText=
new Date().toLocaleTimeString();
},1000);

/* Register */
function register(){
let u=userInput();
let p=passInput();
if(!u||!p) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
localStorage.setItem("user_"+u,p);
alert("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
}

/* Login */
function login(){

let u=userInput();
let p=passInput();

if(localStorage.getItem("user_"+u)===p){

currentUser=u;

loginBox.style.display="none";
sidebar.style.display="block";
home.style.display="block";

welcome.innerText="‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ "+u;

loadCharts();
updateStreak();
loadLeaderboard();

}else alert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

}

function userInput(){ return user.value; }
function passInput(){ return pass.value; }

/* Save Data */
function saveData(){

let h=height.value/100;
let w=weight.value;
let goal=goalInput();

if(!h||!w) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");

let bmi=(w/(h*h)).toFixed(2);

/* ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å history */
let history=JSON.parse(localStorage.getItem("history_"+currentUser))||[];

history.push({
date:new Date().toLocaleDateString(),
weight:Number(w),
bmi:Number(bmi)
});

localStorage.setItem("history_"+currentUser,JSON.stringify(history));

/* Goal */
if(goal){
let diff=(w-goal).toFixed(1);
goalText.innerText= diff>0 ? "‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏•‡∏î‡∏≠‡∏µ‡∏Å "+diff+" ‡∏Å‡∏Å." : "‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß üéâ";
}

/* BMI Level */
let level="";
if(bmi<18.5) level="‡∏ú‡∏≠‡∏°";
else if(bmi<23) level="‡∏õ‡∏Å‡∏ï‡∏¥";
else if(bmi<25) level="‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô";
else if(bmi<30) level="‡∏≠‡πâ‡∏ß‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö1";
else level="‡∏≠‡πâ‡∏ß‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö2";

bmiLevel.innerText="‡∏£‡∏∞‡∏î‡∏±‡∏ö BMI : "+level;

/* ----- STREAK ----- */
let today=new Date().toLocaleDateString();
let lastDate=localStorage.getItem("lastDate_"+currentUser);
let streak=Number(localStorage.getItem("streak_"+currentUser)||0);

if(!lastDate){
streak=1;
}else{

let y=new Date();
y.setDate(y.getDate()-1);
y=y.toLocaleDateString();

if(lastDate===y){
streak++;
}
else if(lastDate!==today){
streak=1;
}

}

localStorage.setItem("streak_"+currentUser,streak);
localStorage.setItem("lastDate_"+currentUser,today);

updateStreak();
loadCharts();
loadLeaderboard();

}

function goalInput(){ return goal.value; }

/* Update Streak */
function updateStreak(){
let s=Number(localStorage.getItem("streak_"+currentUser)||0);
streakText.innerText="üî•".repeat(s)+" ("+s+" ‡∏ß‡∏±‡∏ô)";
}

/* Charts */
function loadCharts(){

let history=JSON.parse(localStorage.getItem("history_"+currentUser))||[];

let labels=history.map(h=>h.date);
let weights=history.map(h=>h.weight);
let bmis=history.map(h=>h.bmi);

if(weightChart) weightChart.destroy();
if(bmiChart) bmiChart.destroy();

weightChart=new Chart(weightChart = document.getElementById("weightChart"),{
type:"line",
data:{labels:labels,datasets:[{label:"‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å",data:weights}]}
});

bmiChart=new Chart(document.getElementById("bmiChart"),{
type:"line",
data:{labels:labels,datasets:[{label:"BMI",data:bmis}]}
});

}

/* Leaderboard */
function loadLeaderboard(){

let users=[];

for(let key in localStorage){

if(key.startsWith("user_")){

let u=key.replace("user_","");
let history=JSON.parse(localStorage.getItem("history_"+u))||[];

let lost=0;
if(history.length>1){
lost=history[0].weight-history[history.length-1].weight;
}

users.push({
name:u,
records:history.length,
lost:lost
});

}
}

let lostSort=[...users].sort((a,b)=>b.lost-a.lost);
let recSort=[...users].sort((a,b)=>b.records-a.records);

lbWeight.innerHTML=lostSort.map(u=>`<li>${u.name} - ${u.lost} ‡∏Å‡∏Å.</li>`).join("");
lbRecord.innerHTML=recSort.map(u=>`<li>${u.name} - ${u.records} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>`).join("");

}

/* Section */
function showSection(id){
home.style.display="none";
leaderboard.style.display="none";
bmiTable.style.display="none";

document.getElementById(id).style.display="block";
}

/* Logout */
function logout(){
location.reload();
}

</script>

</body>
</html>
